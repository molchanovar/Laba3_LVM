 # Start Vagrant
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant up
Bringing machine 'lvm' up with 'virtualbox' provider...
==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...
==> lvm: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> lvm: flag to force provisioning. Provisioners marked to run always will still run.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant ssh
Last login: Tue Dec  1 03:58:42 2020 from 10.0.2.2

# Осталось до основного Д/З 
[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
[vagrant@lvm ~]$ df -Th
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs        38G  741M   37G   2% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   63M  952M   7% /boot
/dev/mapper/otus-test           ext4      9.8G   36M  9.2G   1% /data
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
[vagrant@lvm ~]$ fdisk -f
fdisk: invalid option -- 'f'
Usage:
 fdisk [options] <disk>    change partition table
 fdisk [options] -l <disk> list partition table(s)
 fdisk -s <partition>      give partition size(s) in blocks

Options:
 -b <size>             sector size (512, 1024, 2048 or 4096)
 -c[=<mode>]           compatible mode: 'dos' or 'nondos' (default)
 -h                    print this help text
 -u[=<unit>]           display units: 'cylinders' or 'sectors' (default)
 -v                    print program version
 -C <number>           specify the number of cylinders
 -H <number>           specify the number of heads
 -S <number>           specify the number of sectors per track

[vagrant@lvm ~]$ fdisk -b
fdisk: option requires an argument -- 'b'
Usage:
 fdisk [options] <disk>    change partition table
 fdisk [options] -l <disk> list partition table(s)
 fdisk -s <partition>      give partition size(s) in blocks

Options:
 -b <size>             sector size (512, 1024, 2048 or 4096)
 -c[=<mode>]           compatible mode: 'dos' or 'nondos' (default)
 -h                    print this help text
 -u[=<unit>]           display units: 'cylinders' or 'sectors' (default)
 -v                    print program version
 -C <number>           specify the number of cylinders
 -H <number>           specify the number of heads
 -S <number>           specify the number of sectors per track

[vagrant@lvm ~]$ df -h
Filesystem                       Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00   38G  741M   37G   2% /
devtmpfs                         109M     0  109M   0% /dev
tmpfs                            118M     0  118M   0% /dev/shm
tmpfs                            118M  4.6M  114M   4% /run
tmpfs                            118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       1014M   63M  952M   7% /boot
/dev/mapper/otus-test            9.8G   36M  9.2G   1% /data
tmpfs                             24M     0   24M   0% /run/user/1000
[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
  
# xfsdump installing  
[vagrant@lvm ~]$ sudo su
[root@lvm vagrant]# yum install xfsdump
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.powernet.com.ru
 * extras: tux.rainside.sk
 * updates: mirrors.hostico.ro
Resolving Dependencies
--> Running transaction check
---> Package xfsdump.x86_64 0:3.1.7-1.el7 will be installed
--> Processing Dependency: attr >= 2.0.0 for package: xfsdump-3.1.7-1.el7.x86_64
--> Running transaction check
---> Package attr.x86_64 0:2.4.46-13.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=====================================================================================================================
 Package                    Arch                      Version                          Repository               Size
=====================================================================================================================
Installing:
 xfsdump                    x86_64                    3.1.7-1.el7                      base                    308 k
Installing for dependencies:
 attr                       x86_64                    2.4.46-13.el7                    base                     66 k

Transaction Summary
=====================================================================================================================
Install  1 Package (+1 Dependent package)

Total download size: 374 k
Installed size: 1.1 M
Is this ok [y/d/N]: y
Downloading packages:
(1/2): attr-2.4.46-13.el7.x86_64.rpm                                                          |  66 kB  00:00:00     
(2/2): xfsdump-3.1.7-1.el7.x86_64.rpm                                                         | 308 kB  00:00:00     
---------------------------------------------------------------------------------------------------------------------
Total                                                                                337 kB/s | 374 kB  00:00:01     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : attr-2.4.46-13.el7.x86_64                                                                         1/2 
  Installing : xfsdump-3.1.7-1.el7.x86_64                                                                        2/2 
  Verifying  : attr-2.4.46-13.el7.x86_64                                                                         1/2 
  Verifying  : xfsdump-3.1.7-1.el7.x86_64                                                                        2/2 

Installed:
  xfsdump.x86_64 0:3.1.7-1.el7                                                                                       

Dependency Installed:
  attr.x86_64 0:2.4.46-13.el7                                                                                        

Complete!
[root@lvm vagrant]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g      0 
  /dev/sdb   otus       lvm2 a--   <10.00g      0 
  /dev/sdc   otus       lvm2 a--    <2.00g   1.89g
  /dev/sdd   vg0        lvm2 a--  1020.00m 200.00m
  /dev/sde   vg0        lvm2 a--  1020.00m 200.00m
[root@lvm vagrant]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree  
  VolGroup00   1   2   0 wz--n- <38.97g      0 
  otus         2   2   0 wz--n-  11.99g   1.89g
  vg0          2   1   0 wz--n-   1.99g 400.00m
[root@lvm vagrant]# script
Script started, file is typescript
[root@lvm vagrant]# pvcreate /dev/sdb
  Can't open /dev/sdb exclusively.  Mounted filesystem?
[root@lvm vagrant]# exit
exit
Script done, file is typescript
[root@lvm vagrant]# exit
exit
[vagrant@lvm ~]$ exit
logout
Connection to 127.0.0.1 closed.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant up
Bringing machine 'lvm' up with 'virtualbox' provider...
==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...
==> lvm: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> lvm: flag to force provisioning. Provisioners marked to run always will still run.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant ssh
Last login: Tue Dec  1 04:01:11 2020 from 10.0.2.2
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
[vagrant@lvm ~]$ cd /dev/sdb
-bash: cd: /dev/sdb: Not a directory
[vagrant@lvm ~]$ cd /dev/
[vagrant@lvm dev]$ ls
autofs           hugepages           rtc       tty10  tty32  tty54    vcs2
block            hwrng               rtc0      tty11  tty33  tty55    vcs3
bsg              initctl             sda       tty12  tty34  tty56    vcs4
btrfs-control    input               sda1      tty13  tty35  tty57    vcs5
char             kmsg                sda2      tty14  tty36  tty58    vcs6
console          log                 sda3      tty15  tty37  tty59    vcsa
core             loop-control        sdb       tty16  tty38  tty6     vcsa1
cpu              mapper              sdc       tty17  tty39  tty60    vcsa2
cpu_dma_latency  mcelog              sdd       tty18  tty4   tty61    vcsa3
crash            mem                 sde       tty19  tty40  tty62    vcsa4
disk             mqueue              sg0       tty2   tty41  tty63    vcsa5
dm-0             net                 sg1       tty20  tty42  tty7     vcsa6
dm-1             network_latency     sg2       tty21  tty43  tty8     vfio
dm-2             network_throughput  sg3       tty22  tty44  tty9     vg0
dm-3             null                sg4       tty23  tty45  ttyS0    vga_arbiter
dm-4             nvram               shm       tty24  tty46  ttyS1    vhci
dm-5             oldmem              snapshot  tty25  tty47  ttyS2    vhost-net
dm-6             otus                snd       tty26  tty48  ttyS3    VolGroup00
dm-7             port                stderr    tty27  tty49  uhid     zero
dm-8             ppp                 stdin     tty28  tty5   uinput
fd               ptmx                stdout    tty29  tty50  urandom
full             pts                 tty       tty3   tty51  usbmon0
fuse             random              tty0      tty30  tty52  vcs
hpet             raw                 tty1      tty31  tty53  vcs1
[vagrant@lvm dev]$ ls sdb -lah
brw-rw----. 1 root disk 8, 16 Dec  1 03:28 sdb
[vagrant@lvm dev]$ sudo su
[root@lvm dev]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
[root@lvm dev]# parted /dev/sdb
GNU Parted 3.1
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted)                                                                  
(parted) help                                                             
  align-check TYPE N                        check partition N for TYPE(min|opt)
        alignment
  help [COMMAND]                           print general help, or help on COMMAND
  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)
  mkpart PART-TYPE [FS-TYPE] START END     make a partition
  name NUMBER NAME                         name partition NUMBER as NAME
  print [devices|free|list,all|NUMBER]     display the partition table, available
        devices, free space, all found partitions, or a particular partition
  quit                                     exit program
  rescue START END                         rescue a lost partition near START and END
  
  resizepart NUMBER END                    resize partition NUMBER
  rm NUMBER                                delete partition NUMBER
  select DEVICE                            choose the device to edit
  disk_set FLAG STATE                      change the FLAG on selected device
  disk_toggle [FLAG]                       toggle the state of FLAG on selected
        device
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER
  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition
        NUMBER
  unit UNIT                                set the default unit to UNIT
  version                                  display the version number and copyright
        information of GNU Parted
(parted)                                                                  
(parted)                                                                  
(parted)                                                                  
(parted) exit                                                             
  align-check TYPE N                        check partition N for TYPE(min|opt)
        alignment
  help [COMMAND]                           print general help, or help on COMMAND
  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)
  mkpart PART-TYPE [FS-TYPE] START END     make a partition
  name NUMBER NAME                         name partition NUMBER as NAME
  print [devices|free|list,all|NUMBER]     display the partition table, available
        devices, free space, all found partitions, or a particular partition
  quit                                     exit program
  rescue START END                         rescue a lost partition near START and END
  
  resizepart NUMBER END                    resize partition NUMBER
  rm NUMBER                                delete partition NUMBER
  select DEVICE                            choose the device to edit
  disk_set FLAG STATE                      change the FLAG on selected device
  disk_toggle [FLAG]                       toggle the state of FLAG on selected
        device
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER
  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition
        NUMBER
  unit UNIT                                set the default unit to UNIT
  version                                  display the version number and copyright
        information of GNU Parted
(parted)                                                                  
(parted) quit                                                             
[root@lvm dev]# 
[root@lvm dev]# 
[root@lvm dev]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
[root@lvm dev]# lvremove /dev/sdb/otus-small
  Volume group "sdb" not found
  Cannot process volume group sdb
[root@lvm dev]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/VolGroup00/LogVol00
  LV Name                LogVol00
  VG Name                VolGroup00
  LV UUID                j6b8IV-KEw3-7bTw-Oqy8-1Ud3-juFC-SJBg12
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2018-05-12 18:50:24 +0000
  LV Status              available
  # open                 1
  LV Size                <37.47 GiB
  Current LE             1199
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
  --- Logical volume ---
  LV Path                /dev/VolGroup00/LogVol01
  LV Name                LogVol01
  VG Name                VolGroup00
  LV UUID                IAjIC6-ScnM-tvH6-7BTy-TN31-hd82-bgDSzd
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2018-05-12 18:50:25 +0000
  LV Status              available
  # open                 2
  LV Size                1.50 GiB
  Current LE             48
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                j4TSuZ-CuQe-sECp-C1U9-18Vo-qN41-fR6kpG
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-11-30 21:35:23 +0000
  LV Status              available
  # open                 1
  LV Size                10.00 GiB
  Current LE             2560
  Segments               3
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Logical volume ---
  LV Path                /dev/otus/small
  LV Name                small
  VG Name                otus
  LV UUID                QdlgK2-pDs3-Y3rd-L4Oa-52Gt-Pciy-9uPsJU
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-12-01 02:52:11 +0000
  LV Status              available
  # open                 0
  LV Size                100.00 MiB
  Current LE             25
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:3
   
  --- Logical volume ---
  LV Path                /dev/vg0/mirror
  LV Name                mirror
  VG Name                vg0
  LV UUID                WxHVot-pqyv-n2nt-AlQI-zHqp-RoDy-W0p7u2
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-12-01 03:33:53 +0000
  LV Status              available
  # open                 0
  LV Size                816.00 MiB
  Current LE             204
  Mirrored volumes       2
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:8
   

[root@lvm dev]# df -tH
df: no file systems processed
[root@lvm dev]# df -hT
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs        38G  743M   37G   2% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   63M  952M   7% /boot
/dev/mapper/otus-test           ext4      9.8G   36M  9.2G   1% /data
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
[root@lvm dev]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
├─otus-test             253:2    0   10G  0 lvm  /data
└─otus-small            253:3    0  100M  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  /data
sdd                       8:48   0    1G  0 disk 
├─vg0-mirror_rmeta_0    253:4    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_0   253:5    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
sde                       8:64   0    1G  0 disk 
├─vg0-mirror_rmeta_1    253:6    0    4M  0 lvm  
│ └─vg0-mirror          253:8    0  816M  0 lvm  
└─vg0-mirror_rimage_1   253:7    0  816M  0 lvm  
  └─vg0-mirror          253:8    0  816M  0 lvm  
[root@lvm dev]# umount /dev/otus/test /data/
umount: /data/: not mounted
[root@lvm dev]# cd /data
[root@lvm data]# ls
[root@lvm data]# ls -lah
total 0
drwxr-xr-x.  2 root root   6 Dec  1 02:56 .
dr-xr-xr-x. 20 root root 286 Dec  1 03:38 ..
[root@lvm data]# cd

[root@lvm ~]# mount | grep dev/sdb
[root@lvm ~]# mount | grep otus
[root@lvm ~]# mount | grep data
[root@lvm ~]# lvdisplay
  --- Logical volume ---
  LV Path                /dev/VolGroup00/LogVol00
  LV Name                LogVol00
  VG Name                VolGroup00
  LV UUID                j6b8IV-KEw3-7bTw-Oqy8-1Ud3-juFC-SJBg12
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2018-05-12 18:50:24 +0000
  LV Status              available
  # open                 1
  LV Size                <37.47 GiB
  Current LE             1199
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
  --- Logical volume ---
  LV Path                /dev/VolGroup00/LogVol01
  LV Name                LogVol01
  VG Name                VolGroup00
  LV UUID                IAjIC6-ScnM-tvH6-7BTy-TN31-hd82-bgDSzd
  LV Write Access        read/write
  LV Creation host, time localhost.localdomain, 2018-05-12 18:50:25 +0000
  LV Status              available
  # open                 2
  LV Size                1.50 GiB
  Current LE             48
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/otus/test
  LV Name                test
  VG Name                otus
  LV UUID                j4TSuZ-CuQe-sECp-C1U9-18Vo-qN41-fR6kpG
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-11-30 21:35:23 +0000
  LV Status              available
  # open                 0
  LV Size                10.00 GiB
  Current LE             2560
  Segments               3
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Logical volume ---
  LV Path                /dev/otus/small
  LV Name                small
  VG Name                otus
  LV UUID                QdlgK2-pDs3-Y3rd-L4Oa-52Gt-Pciy-9uPsJU
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-12-01 02:52:11 +0000
  LV Status              available
  # open                 0
  LV Size                100.00 MiB
  Current LE             25
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:3
   
  --- Logical volume ---
  LV Path                /dev/vg0/mirror
  LV Name                mirror
  VG Name                vg0
  LV UUID                WxHVot-pqyv-n2nt-AlQI-zHqp-RoDy-W0p7u2
  LV Write Access        read/write
  LV Creation host, time lvm, 2020-12-01 03:33:53 +0000
  LV Status              available
  # open                 0
  LV Size                816.00 MiB
  Current LE             204
  Mirrored volumes       2
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:8
   
[root@lvm ~]# lvremove /dev/vg0/mirror
Do you really want to remove active logical volume vg0/mirror? [y/n]: y
  Logical volume "mirror" successfully removed
[root@lvm ~]# lvremove /dev/otus/small
Do you really want to remove active logical volume otus/small? [y/n]: y
  Logical volume "small" successfully removed
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  
sdc                       8:32   0    2G  0 disk 
└─otus-test             253:2    0   10G  0 lvm  
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# lvremove /dev/otus/test
Do you really want to remove active logical volume otus/test? [y/n]: y
  Logical volume "test" successfully removed
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# script
Script started, file is typescript
[root@lvm ~]# ls
anaconda-ks.cfg  original-ks.cfg  typescript

# 8GB for Root
[root@lvm ~]# pvcreate /dev/sdb -ff
Really INITIALIZE physical volume "/dev/sdb" of volume group "otus" [y/n]? y
  WARNING: Forcing physical volume creation on /dev/sdb of volume group "otus"
  Physical volume "/dev/sdb" successfully created.
[root@lvm ~]# lvmdiskscan 
  /dev/VolGroup00/LogVol00 [     <37.47 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] LVM physical volume
  /dev/sdc                 [       2.00 GiB] LVM physical volume
  /dev/sdd                 [       1.00 GiB] LVM physical volume
  /dev/sde                 [       1.00 GiB] LVM physical volume
  0 disks
  3 partitions
  4 LVM physical volume whole disks
  1 LVM physical volume
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# vgcreate vg_root /dev/sdb
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.
  Volume group "vg_root" successfully created
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# lvmdiskscan
  /dev/VolGroup00/LogVol00 [     <37.47 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] LVM physical volume
  /dev/sdc                 [       2.00 GiB] LVM physical volume
  /dev/sdd                 [       1.00 GiB] LVM physical volume
  /dev/sde                 [       1.00 GiB] LVM physical volume
  0 disks
  3 partitions
  4 LVM physical volume whole disks
  1 LVM physical volume
[root@lvm ~]# lvmcreate -n lv_root -l +100%FREE /dev/vg_root
bash: lvmcreate: command not found
[root@lvm ~]# lvcreate -n lv_root -l +100%FREE /dev/vg_root
WARNING: ext4 signature detected on /dev/vg_root/lv_root at offset 1080. Wipe it? [y/n]: y
  Wiping ext4 signature on /dev/vg_root/lv_root.
  Logical volume "lv_root" created.
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# lvmdiskscan 
  /dev/VolGroup00/LogVol00 [     <37.47 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/vg_root/lv_root     [     <10.00 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] LVM physical volume
  /dev/sdc                 [       2.00 GiB] LVM physical volume
  /dev/sdd                 [       1.00 GiB] LVM physical volume
  /dev/sde                 [       1.00 GiB] LVM physical volume
  1 disk
  3 partitions
  4 LVM physical volume whole disks
  1 LVM physical volume
[root@lvm ~]# lvs
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao---- <37.47g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    

# ext file system
[root@lvm ~]# 
[root@lvm ~]# 
[root@lvm ~]# mkfs.xfs /dev/vg_root/lv_root 
meta-data=/dev/vg_root/lv_root   isize=512    agcount=4, agsize=655104 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2620416, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# mount /dev/vg_root/lv_root /mnt
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  /mnt
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# mount | grep vs
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  /mnt
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# xfsdump -J /dev/VolGroup00/logVol00 | xfsrestore -J - /mnt
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0)
xfsdump: usage: xfsdump [ -a (dump DMF dualstate files as offline) ]
                        [ -b <blocksize> ]
                        [ -c <media change alert program>  ]
                        [ -d <dump media file size>  ]
                        [ -e (allow files to be excluded) ]
                        [ -f <destination> ... ]
                        [ -h (help) ]
                        [ -l <level> ]
                        [ -m (force usage of minimal rmt) ]
                        [ -o (overwrite tape) ]
                        [ -p <seconds between progress reports> ]
                        [ -q <use QIC tape settings> ]
                        [ -s <subtree> ... ]
                        [ -t <file> (use file mtime for dump time ]
                        [ -v <verbosity {silent, verbose, trace}> ]
                        [ -z <maximum file size> ]
                        [ -A (don't dump extended file attributes) ]
                        [ -B <base dump session id> ]
                        [ -D (skip unchanged directories) ]
                        [ -E (pre-erase media) ]
                        [ -F (don't prompt) ]
                        [ -I (display dump inventory) ]
                        [ -J (inhibit inventory update) ]
                        [ -K (generate format 2 dump) ]
                        [ -L <session label> ]
                        [ -M <media label> ... ]
                        [ -O <options file> ]
                        [ -R (resume) ]
                        [ -T (don't timeout dialogs) ]
                        [ -Y <I/O buffer ring length> ]
                        [ - (stdout) ]
                        [ <source (mntpnt|device)> ]
xfsrestore: searching media for dump
xfsrestore: restore complete: 0 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@lvm ~]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  /
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  /mnt
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm ~]# df -hT
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs        38G  743M   37G   2% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   63M  952M   7% /boot
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
/dev/mapper/vg_root-lv_root     xfs        10G   33M   10G   1% /mnt
[root@lvm ~]# ls /mnt

[root@lvm ~]# ls /dev/VolGroup00/
LogVol00  LogVol01
[root@lvm ~]# xfsdump -J - /dev/VolGroup00/LogVol00 | xfsrestore -J - /mnt
xfsrestore: using file dump (drive_simple) strategy
xfsrestore: version 3.1.7 (dump format 3.0)
xfsdump: using file dump (drive_simple) strategy
xfsdump: version 3.1.7 (dump format 3.0)
xfsdump: level 0 dump of lvm:/
xfsdump: dump date: Tue Dec  1 04:55:53 2020
xfsdump: session id: bd692a09-f9d7-484c-9465-66e17aa8f7e0
xfsdump: session label: ""
xfsrestore: searching media for dump
xfsdump: ino map phase 1: constructing initial dump list
xfsdump: ino map phase 2: skipping (no pruning necessary)
xfsdump: ino map phase 3: skipping (only one dump stream)
xfsdump: ino map construction complete
xfsdump: estimated dump size: 739124992 bytes
xfsdump: creating dump session media file 0 (media 0, file 0)
xfsdump: dumping ino map
xfsdump: dumping directories
xfsrestore: examining media file 0
xfsrestore: dump description: 
xfsrestore: hostname: lvm
xfsrestore: mount point: /
xfsrestore: volume: /dev/mapper/VolGroup00-LogVol00
xfsrestore: session time: Tue Dec  1 04:55:53 2020
xfsrestore: level: 0
xfsrestore: session label: ""
xfsrestore: media label: ""
xfsrestore: file system id: b60e9498-0baa-4d9f-90aa-069048217fee
xfsrestore: session id: bd692a09-f9d7-484c-9465-66e17aa8f7e0
xfsrestore: media id: 380d5c96-cdaa-475d-ba38-339557668740
xfsrestore: searching media for directory dump
xfsrestore: reading directories
xfsdump: dumping non-directory files
xfsrestore: 2720 directories and 23666 entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsdump: ending media file
xfsdump: media file size 716129096 bytes
xfsdump: dump size (non-dir files) : 702932936 bytes
xfsdump: dump complete: 19 seconds elapsed
xfsdump: Dump Status: SUCCESS
xfsrestore: restore complete: 19 seconds elapsed
xfsrestore: Restore Status: SUCCESS
[root@lvm ~]# ls /mnt
bin   data       dev  home  lib64  mnt  proc  run   srv  tmp         usr      var
boot  data-snap  etc  lib   media  opt  root  sbin  sys  typescript  vagrant
[root@lvm ~]# for i in /proc/ /sys/ /dev/ /run/ /boot/; do mount --bind $i /mnt/$i; done
[root@lvm ~]# chroot /mnt/
[root@lvm /]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.

# Update initrd
[root@lvm boot]# cd /boot; for i in 'ls initramfs-*img'; do dracut -v $i'echo $i|sed "s/initramfs-//g;s/.img//g' --force; done
/sbin/dracut: line 589: [: too many arguments
Kernel version initramfs-*imgecho $i|sed "s/initramfs-//g;s/.img//g has no module directory /lib/modules/initramfs-*imgecho $i|sed "s/initramfs-//g;s/.img//g
Executing: /sbin/dracut -v ls "initramfs-*imgecho $i|sed "s/initramfs-//g;s/.img//g" --force
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
Failed to install module hv_netvsc

Broadcast message from systemd-journald@lvm (Tue 2020-12-01 05:04:19 UTC):

dracut[7274]: Failed to install module hv_netvsc


Broadcast message from systemd-journald@lvm (Tue 2020-12-01 05:04:19 UTC):

dracut[7274]: Failed to install module hv_netvsc


Message from syslogd@localhost at Dec  1 05:04:19 ...
 dracut:Failed to install module hv_netvsc

Message from syslogd@localhost at Dec  1 05:04:19 ...
 dracut:Failed to install module hv_netvsc
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** No early-microcode cpio image needed ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/ls' done ***

# Change rd.lvm.lv
[root@lvm boot]# cd /boot/grub2/
[root@lvm grub2]# ls
device.map  fonts  grub.cfg  grubenv  i386-pc  locale
[root@lvm grub2]# cat grub.cfg 
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=1
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=1
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-862.2.3.el7.x86_64-advanced-f6d3e12e-00c1-46b1-a3ef-5e619d327e9c' {
	load_video
	set gfxpayload=keep
	insmod gzio
	insmod part_msdos
	insmod xfs
	set root='hd0,msdos2'
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos2 --hint-efi=hd0,msdos2 --hint-baremetal=ahci0,msdos2  570897ca-e759-4c81-90cf-389da6eee4cc
	else
	  search --no-floppy --fs-uuid --set=root 570897ca-e759-4c81-90cf-389da6eee4cc
	fi
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/vg_root-lv_root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 
	initrd16 /initramfs-3.10.0-862.2.3.el7.x86_64.img
}
if [ "x$default" = 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' ]; then default='Advanced options for CentOS Linux>CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)'; fi;
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
[root@lvm grub2]# cat grub.cfg | grep rd.lvm
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/vg_root-lv_root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 
[root@lvm grub2]# vi grub.cfg 
[root@lvm grub2]# cat grub.cfg | grep rd.lvm
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/vg_root-lv_root ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=vg_root/lv_root rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 
[root@lvm grub2]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00 253:0    0 37.5G  0 lvm  
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:2    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 

# reboot
[root@lvm grub2]# reboot
Running in chroot, ignoring request.
[root@lvm grub2]# cd
[root@lvm ~]# reboot
Running in chroot, ignoring request.
[root@lvm ~]# exit
exit
[root@lvm ~]# reboot
Connection to 127.0.0.1 closed by remote host.
Connection to 127.0.0.1 closed.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant ssh
Last login: Tue Dec  1 04:19:27 2020 from 10.0.2.2
[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol00 253:2    0 37.5G  0 lvm  
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:0    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 

[vagrant@lvm ~]$ lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol00 253:2    0 37.5G  0 lvm  
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:0    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[vagrant@lvm ~]$ vgdisplay 
  WARNING: Running as a non-root user. Functionality may be unavailable.
  /run/lvm/lvmetad.socket: access failed: Permission denied
  WARNING: Failed to connect to lvmetad. Falling back to device scanning.
  /dev/mapper/control: open failed: Permission denied
  Failure to communicate with kernel device-mapper driver.
  Incompatible libdevmapper 1.02.146-RHEL7 (2018-01-22) and kernel driver (unknown version).
[vagrant@lvm ~]$ sudo su
[root@lvm vagrant]# vgdisplay 
  --- Volume group ---
  VG Name               VolGroup00
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               1
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <38.97 GiB
  PE Size               32.00 MiB
  Total PE              1247
  Alloc PE / Size       1247 / <38.97 GiB
  Free  PE / Size       0 / 0   
  VG UUID               SA8LTU-F2yz-FEV1-RdgT-hw0Z-iRxh-yHFKuU
   
  --- Volume group ---
  VG Name               vg_root
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2559 / <10.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               KK8xDh-r6Sz-xb61-22i3-mLR1-wxai-eTRZNI
   
  WARNING: Device for PV zGvbzc-bX32-PF7x-aac9-jxOI-a5lR-Z8BT3p not found or rejected by a filter.
  --- Volume group ---
  VG Name               otus
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  13
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                1
  VG Size               11.99 GiB
  PE Size               4.00 MiB
  Total PE              3070
  Alloc PE / Size       0 / 0   
  Free  PE / Size       3070 / 11.99 GiB
  VG UUID               13QbfL-jWGb-seWS-LCAV-1hQZ-y0YO-cbdrzO
   
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  4
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               1.99 GiB
  PE Size               4.00 MiB
  Total PE              510
  Alloc PE / Size       0 / 0   
  Free  PE / Size       510 / 1.99 GiB
  VG UUID               pB9Xu2-rFx9-8u1h-EEHI-83fy-rI0E-xwohwM
   
[root@lvm vagrant]# lvmdiskscan 
  /dev/vg_root/lv_root     [     <10.00 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/VolGroup00/LogVol00 [     <37.47 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] LVM physical volume
  /dev/sdc                 [       2.00 GiB] LVM physical volume
  /dev/sdd                 [       1.00 GiB] LVM physical volume
  /dev/sde                 [       1.00 GiB] LVM physical volume
  1 disk
  3 partitions
  4 LVM physical volume whole disks
  1 LVM physical volume
  
 # Delete old LV
[root@lvm vagrant]# lvremove /dev/VolGroup00/LogVol00
Do you really want to remove active logical volume VolGroup00/LogVol00? [y/n]: y
  Logical volume "LogVol00" successfully removed
[root@lvm vagrant]# lvmdiskscan 
  /dev/vg_root/lv_root     [     <10.00 GiB] 
  /dev/VolGroup00/LogVol01 [       1.50 GiB] 
  /dev/sda2                [       1.00 GiB] 
  /dev/sda3                [     <39.00 GiB] LVM physical volume
  /dev/sdb                 [      10.00 GiB] LVM physical volume
  /dev/sdc                 [       2.00 GiB] LVM physical volume
  /dev/sdd                 [       1.00 GiB] LVM physical volume
  /dev/sde                 [       1.00 GiB] LVM physical volume
  1 disk
  2 partitions
  4 LVM physical volume whole disks
  1 LVM physical volume
[root@lvm vagrant]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  └─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:0    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 
[root@lvm vagrant]# lvcreate -n VolGroup00/LogVol00 -L 8G /dev/VolGroup00
WARNING: xfs signature detected on /dev/VolGroup00/LogVol00 at offset 0. Wipe it? [y/n]: y
  Wiping xfs signature on /dev/VolGroup00/LogVol00.
  Logical volume "LogVol00" created.
[root@lvm vagrant]# lsblk
NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                       8:0    0   40G  0 disk 
├─sda1                    8:1    0    1M  0 part 
├─sda2                    8:2    0    1G  0 part /boot
└─sda3                    8:3    0   39G  0 part 
  ├─VolGroup00-LogVol01 253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol00 253:2    0    8G  0 lvm  
sdb                       8:16   0   10G  0 disk 
└─vg_root-lv_root       253:0    0   10G  0 lvm  /
sdc                       8:32   0    2G  0 disk 
sdd                       8:48   0    1G  0 disk 
sde                       8:64   0    1G  0 disk 




[root@lvm vagrant]# 
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant up
Bringing machine 'lvm' up with 'virtualbox' provider...
==> lvm: Checking if box 'centos/7' version '1804.02' is up to date...
==> lvm: Clearing any previously set forwarded ports...
==> lvm: Clearing any previously set network interfaces...
==> lvm: Preparing network interfaces based on configuration...
    lvm: Adapter 1: nat
    lvm: Adapter 2: hostonly
==> lvm: Forwarding ports...
    lvm: 22 (guest) => 2222 (host) (adapter 1)
==> lvm: Running 'pre-boot' VM customizations...
==> lvm: Booting VM...
==> lvm: Waiting for machine to boot. This may take a few minutes...
    lvm: SSH address: 127.0.0.1:2222
    lvm: SSH username: vagrant
    lvm: SSH auth method: private key
==> lvm: Machine booted and ready!
==> lvm: Checking for guest additions in VM...
    lvm: No guest additions were detected on the base box for this VM! Guest
    lvm: additions are required for forwarded ports, shared folders, host only
    lvm: networking, and more. If SSH fails on this machine, please install
    lvm: the guest additions and repackage the box to continue.
    lvm: 
    lvm: This is not an error message; everything may continue to work properly,
    lvm: in which case you may ignore this message.
==> lvm: Setting hostname...
==> lvm: Configuring and enabling network interfaces...
==> lvm: Rsyncing folder: /home/artem/Otus_lab/Laba3/test/ => /vagrant
==> lvm: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> lvm: flag to force provisioning. Provisioners marked to run always will still run.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant ssh
Last login: Tue Dec  1 05:22:41 2020 from 10.0.2.2
[vagrant@lvm ~]$ ls
typescript
[vagrant@lvm ~]$ cat typescript 
Script started on Thu 03 Dec 2020 10:15:53 PM UTC

[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ script
script: cannot open typescript: Permission denied
Terminated
[vagrant@lvm ~]$ sudo su
[root@lvm vagrant]# script
Script started, file is typescript
[root@lvm vagrant]# awd
bash: awd: command not found
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sde                        8:64   0    1G  0 disk 
[root@lvm vagrant]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm vagrant]# pwd
/home/vagrant
[root@lvm vagrant]# cd /boot/grub2
[root@lvm grub2]# ls
device.map  fonts  grub.cfg  grubenv  i386-pc  locale
[root@lvm grub2]# cat grub.cfg | grep rd.lvm.lv
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/VolGroup00-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 
[root@lvm grub2]# history
    1  script --help
    2  top
    3  script --help
    4  script -V
    5  lsblk
    6  exit
    7  lvmdiskscan
    8  pvcreate /dev/sdb
    9  lvmdiskscan
   10  vgcreate otus /dev/sdb
   11  lvmdiskscan
   12  lsblk
   13  vgremove otus 
   14  vgcreate otus /dev/sdb
   15  vgdisplay otus 
   16  pvs
   17  pvscan
   18  pvdisplay 
   19  lvcreate -l +80%FREE -n test otus
   20  pvdisplay 
   21  pvscan
   22  lsblk
   23  vgdisplay otus
   24  vgdisplay -v otus | grep 'PV NAME'
   25  vgdisplay -v otus 
   26  vgdisplay -v otus | grep 'PV Name'
   27  grep --help
   28  vgdisplay -v otus | grep -i 'PV Name'
   29  vgdisplay -v otus | grep -i 'PV NAME'
   30  lvdisplay /dev/otus/test
   31  vgs
   32  lvs
   33  vgdisplay 
   34  lvs
   35  lvcreate -L 100M -n small otus
   36  lvs
   37  mkfs.ext4 /dev/otus/test
   38  lvs
   39  lsblk
   40  df -h
   41  mkdir /data
   42  ls
   43  cd /
   44  ls
   45  mount /dev/otus/test/data/
   46  rm -r data/
   47  ls
   48  cd /dev/otus/test/
   49  cd /dev/otus/test
   50  cd /dev/otus
   51  ls
   52  ls -lah
   53  cd
   54  mkdir /data
   55  ls
   56  ls
   57  mkdir /data
   58  ls -lah
   59  mount /dev/otus/test/data/
   60  ls
   61  cd /
   62  ls
   63  mount /dev/otus/test/ /data/
   64  mount | grep /data
   65  ls -lah
   66  cd data/
   67  ls
   68  cd
   69  cd /
   70  lsblk
   71  mount
   72  lsblk
   73  pvcreate /dev/sdc
   74  pvs
   75  lsblk
   76  vgs
   77  pgs
   78  lvs
   79  vgextend otus /dev/sdc
   80  vgs
   81  lsblk
   82  vgs
   83  vgdisplay 
   84  vgdisplay -v otus | grep 'PV Name'
   85  vgdisplay -v otus 
   86  vgs
   87  dd if=/dev/zero of=/data/test.log bs=1M count=8000 status=progress
   88  df -Th /data/
   89  lvextend -l+80%FREE /dev/otus/test
   90  lsblk
   91  df -Th /data
   92  resize2fs /dev/otus/test
   93  df -Th /data
   94  umount /data/
   95  lsblk
   96  e2fsck -fy /dev/otus/test
   97  resize2fs /dev/otus/test 10G
   98  lsblk
   99  df -Th /data
  100  df -Th
  101  resize2fs /dev/otus/test -L 10G
  102  lvg
  103  lvs
  104  lvreduce /dev/otus/test -L 10G
  105  lsblk
  106  lvs
  107  mount /dev/otus/test /data/
  108  df -Th
  109  df -Th /data/
  110  lvs /dev/otus/test
  111  lvcreate -L 500M -s -n test-snap /dev/otus/test
  112  lvs
  113  lsblk
  114  vgs -o +lv_size,lv_name | grep test
  115  vgs -o +lv_size,lv_name 
  116  pwd
  117  mkdir /data-snap 
  118  ls -lah
  119  mount /dev/otus/test-snap /data-snap/
  120  cd dev
  121  ls
  122  cd otus/
  123  ls
  124  cd /
  125  ll 
  126  ll /data-snap/
  127  cat /data-snap/test.log 
  128  tail -n 10  /data-snap/test.log 
  129  cd data-snap/
  130  vi test.log 
  131  cd /
  132  unmount /data-snap/
  133  lsblk
  134  unmount /data-snap
  135  umount /data-snap
  136  lsblk
  137  cd data-snap/
  138  ls
  139  ls -la
  140  mount /dev/otus/test-snap /data-snap/
  141  ls
  142  lsblk
  143  ll
  144  cd
  145  ll
  146  cd /
  147  ls
  148  cd data-snap/
  149  ls
  150  rm test.log 
  151  rm test.log 
  152  ls
  153  cd / 
  154  umount /data-snap/
  155  umount /data
  156  lsblk
  157  lvconvert --merge /dev/otus/test-snap 
  158  mount /dev/otus/test /data
  159  lsblk
  160  ll /data
  161  ls -lah
  162  cd data-snap/
  163  ls
  164  cd /data
  165  ll
  166  cd /data-snap/
  167  ll
  168  cd /
  169  lsblk 
  170  pvcreate /dev/sd{d,e}
  171  lsblk
  172  pvs
  173  vgcreate vg0 /dev/sd{d,e}
  174  vls
  175  history | grep v
  176  vgs
  177  lvcreate -l +80%FREE -m1 -n mirror vg0
  178  lvs
  179  lvs
  180  lvs
  181  lsblk
  182  history
  183  yum install script
  184  script
  185  eexit
  186  exit
  187  pvcreate /dev/sdb
  188  exit
  189  yum install xfsdump
  190  pvs
  191  vgs
  192  script
  193  exit
  194  grub2-mkconfig -o /boot/grub2/grub.cfg 
  195  cd /boot; for i in 'ls initramfs-*img'; do dracut -v $i 'echo $i|sed "s/initramfs-//g; s/.img//g' --force; done
  196  cd /boot; for i in 'ls initramfs-*img'; do dracut -v $i 'echo $i|sed "s/initramfs-//g;s/.img//g' --force; done
  197  cd /boot; for i in 'ls initramfs-*img'; do dracut -v $i'echo $i|sed "s/initramfs-//g;s/.img//g' --force; done
  198  cd /boot/grub2/
  199  ls
  200  cat grub.cfg 
  201  cat grub.cfg | grep rd.lvm
  202  vi grub.cfg 
  203  cat grub.cfg | grep rd.lvm
  204  lsblk
  205  reboot
  206  cd
  207  reboot
  208  exit
  209  lsblk
  210  grub2-mkconfig -o /boot/grub2/grub.cfg 
  211  cd /boot; for i in 'ls initramfs-*img'; do dracut -v $i'echo $i|sed "s/initramfs-//g;s/.img//g' --force; done
  212  lsblk
  213  pvcreate /dev/sdc /dec/sdd
  214  pvcreate /dev/sdc /dev/sdd
  215  cd
  216  exit
  217  awd
  218  ls
  219  cat typescript 
  220  ls
  221  cat typescript 
  222  ls
  223  lsblk
  224  lvs
  225  pwd
  226  cd /boot/grub2
  227  ls
  228  cat grub.cfg | grep rd.lvm.lv
  229  history

[root@lvm grub2]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdb   vg_root    lvm2 a--   <10.00g      0 
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm grub2]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree  
  VolGroup00   1   2   0 wz--n- <38.97g <29.47g
  vg_root      1   1   0 wz--n- <10.00g      0 
  vg_var       2   1   0 wz--n-   2.99g   1.12g
[root@lvm grub2]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm grub2]# mkfs.ext4 /dev/vg_var/lv_var
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done

[root@lvm grub2]# mount /dev/vg_var/lv_var /mnt
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cp -aR /var/* /mnt/      # rsync -avHPSAX /var/ /mnt/
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell

[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# df -Th
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs       8.0G  742M  7.3G  10% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   76M  939M   8% /boot
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
/dev/mapper/vg_var-lv_var       ext4      922M  116M  742M  14% /mnt
[root@lvm var]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# mkdir oldvar
[root@lvm tmp]# ls
oldvar
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# mv /var/* /tmp/oldvar
mv: cannot move ‘/var/tmp’ to ‘/tmp/oldvar/tmp’: Device or resource busy
[root@lvm var]# cp /var/* /tmp/oldvar
cp: omitting directory ‘/var/tmp’
[root@lvm var]# cp -r /var/* /tmp/oldvar
[root@lvm var]# cd /tmp/oldvar/
[root@lvm oldvar]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm oldvar]# ls -lah
total 16K
drwxr-xr-x. 18 root root  238 Dec  5 13:44 .
drwxrwxrwt. 12 root root 4.0K Dec  5 13:45 ..
drwxr-xr-x.  2 root root    6 Apr 11  2018 adm
drwxr-xr-x.  5 root root   44 May 12  2018 cache
drwxr-xr-x.  3 root root   34 May 12  2018 db
drwxr-xr-x.  3 root root   18 May 12  2018 empty
drwxr-xr-x.  2 root root    6 Apr 11  2018 games
drwxr-xr-x.  2 root root    6 Apr 11  2018 gopher
drwxr-xr-x.  3 root root   18 May 12  2018 kerberos
drwxr-xr-x. 28 root root 4.0K Dec  3 22:21 lib
drwxr-xr-x.  2 root root    6 Apr 11  2018 local
lrwxrwxrwx.  1 root root   11 Dec  3 22:21 lock -> ../run/lock
drwxr-xr-x.  8 root root 4.0K Dec  5 13:27 log
lrwxrwxrwx.  1 root root   10 Dec  3 22:21 mail -> spool/mail
drwxr-xr-x.  2 root root    6 Apr 11  2018 nis
drwxr-xr-x.  2 root root    6 Apr 11  2018 opt
drwxr-xr-x.  2 root root    6 Apr 11  2018 preserve
lrwxrwxrwx.  1 root root    6 Dec  3 22:21 run -> ../run
drwxr-xr-x.  8 root root   87 May 12  2018 spool
drwxr-xr-t.  6 root root 4.0K Dec  5 13:44 tmp
drwxr-xr-x.  2 root root    6 Apr 11  2018 yp
[root@lvm oldvar]# rm -r /var/*
rm: descend into directory ‘/var/tmp’? y
rm: descend into directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: descend into directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: descend into directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: descend into directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# ls /var
tmp
[root@lvm oldvar]# rm -r /var
rm: descend into directory ‘/var’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# umount /mnt
[root@lvm oldvar]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sde                        8:64   0    1G  0 disk 
[root@lvm oldvar]# mount /dev/vg_var/lv_var /var
[root@lvm oldvar]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 
[root@lvm oldvar]# echo "`blkid | grep var: | awk '{print $2}'` /var ext4 defaults 0 0" >> /etc/fstab
[root@lvm oldvar]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 

[root@lvm oldvar]# reboot
Connection to 127.0.0.1 closed by remote host.
Connection to 127.0.0.1 closed.
artem@Sony-PC:~/Otus_lab/Laba3/test$ vagrant ssh
Last login: Sat Dec  5 13:27:55 2020 from 10.0.2.2
[vagrant@lvm ~]$ lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:2    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:3    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:4    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:5    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:6    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 
[vagrant@lvm ~]$ script
script: cannot open typescript: Permission denied
Terminated
[vagrant@lvm ~]$ sudo su
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# exit
exit
[vagrant@lvm ~]$ cat typescript 
Script started on Sat 05 Dec 2020 01:28:26 PM UTC
[root@lvm vagrant]# awd
bash: awd: command not found
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sde                        8:64   0    1G  0 disk 
[root@lvm vagrant]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm vagrant]# pwd
/home/vagrant
[root@lvm vagrant]# cd /boot/grub2
[root@lvm grub2]# ls
device.map  fonts  grub.cfg  grubenv  i386-pc  locale
[root@lvm grub2]# cat grub.cfg | grep rd.lvm.lv
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/VolGroup00-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 

[root@lvm grub2]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdb   vg_root    lvm2 a--   <10.00g      0 
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm grub2]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree  
  VolGroup00   1   2   0 wz--n- <38.97g <29.47g
  vg_root      1   1   0 wz--n- <10.00g      0 
  vg_var       2   1   0 wz--n-   2.99g   1.12g
[root@lvm grub2]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm grub2]# mkfs.ext4 /dev/vg_var/lv_var
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done

[root@lvm grub2]# mount /dev/vg_var/lv_var /mnt
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cp -aR /var/* /mnt/      # rsync -avHPSAX /var/ /mnt/
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# cd /vat
bash: cd: /vat: No such file or directory
[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# df -Th
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs       8.0G  742M  7.3G  10% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   76M  939M   8% /boot
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
/dev/mapper/vg_var-lv_var       ext4      922M  116M  742M  14% /mnt
[root@lvm var]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# mkdir oldvar
[root@lvm tmp]# ls
oldvar
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# mv /var/* /tmp/oldvar
mv: cannot move ‘/var/tmp’ to ‘/tmp/oldvar/tmp’: Device or resource busy
[root@lvm var]# cp /var/* /tmp/oldvar
cp: omitting directory ‘/var/tmp’
[root@lvm var]# cp -r /var/* /tmp/oldvar
[root@lvm var]# cd /tmp/oldvar/
[root@lvm oldvar]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm oldvar]# ls -lah
total 16K
drwxr-xr-x. 18 root root  238 Dec  5 13:44 .
drwxrwxrwt. 12 root root 4.0K Dec  5 13:45 ..
drwxr-xr-x.  2 root root    6 Apr 11  2018 adm
drwxr-xr-x.  5 root root   44 May 12  2018 cache
drwxr-xr-x.  3 root root   34 May 12  2018 db
drwxr-xr-x.  3 root root   18 May 12  2018 empty
drwxr-xr-x.  2 root root    6 Apr 11  2018 games
drwxr-xr-x.  2 root root    6 Apr 11  2018 gopher
drwxr-xr-x.  3 root root   18 May 12  2018 kerberos
drwxr-xr-x. 28 root root 4.0K Dec  3 22:21 lib
drwxr-xr-x.  2 root root    6 Apr 11  2018 local
lrwxrwxrwx.  1 root root   11 Dec  3 22:21 lock -> ../run/lock
drwxr-xr-x.  8 root root 4.0K Dec  5 13:27 log
lrwxrwxrwx.  1 root root   10 Dec  3 22:21 mail -> spool/mail
drwxr-xr-x.  2 root root    6 Apr 11  2018 nis
drwxr-xr-x.  2 root root    6 Apr 11  2018 opt
drwxr-xr-x.  2 root root    6 Apr 11  2018 preserve
lrwxrwxrwx.  1 root root    6 Dec  3 22:21 run -> ../run
drwxr-xr-x.  8 root root   87 May 12  2018 spool
drwxr-xr-t.  6 root root 4.0K Dec  5 13:44 tmp
drwxr-xr-x.  2 root root    6 Apr 11  2018 yp
[root@lvm oldvar]# rm -r /var/*
rm: descend into directory ‘/var/tmp’? y
rm: descend into directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: descend into directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: descend into directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: descend into directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# ls /var
tmp
[root@lvm oldvar]# rm -r /var
rm: descend into directory ‘/var’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# umount /mnt
[root@lvm oldvar]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ cat typescript 
Script started on Sat 05 Dec 2020 01:28:26 PM UTC
[root@lvm vagrant]# awd
bash: awd: command not found
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# cat typescript 
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sde                        8:64   0    1G  0 disk 
[root@lvm vagrant]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm vagrant]# pwd
/home/vagrant
[root@lvm vagrant]# cd /boot/grub2
[root@lvm grub2]# ls
device.map  fonts  grub.cfg  grubenv  i386-pc  locale
[root@lvm grub2]# cat grub.cfg | grep rd.lvm.lv
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/VolGroup00-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 rd.lvm.lv=VolGroup00/LogVol01 rhgb quiet 


# Tom for /var in mirror
[root@lvm grub2]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdb   vg_root    lvm2 a--   <10.00g      0 
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm grub2]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree  
  VolGroup00   1   2   0 wz--n- <38.97g <29.47g
  vg_root      1   1   0 wz--n- <10.00g      0 
  vg_var       2   1   0 wz--n-   2.99g   1.12g
[root@lvm grub2]# lvs
  LV       VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00 VolGroup00 -wi-ao----   8.00g                                                    
  LogVol01 VolGroup00 -wi-ao----   1.50g                                                    
  lv_root  vg_root    -wi-a----- <10.00g                                                    
  lv_var   vg_var     rwi-a-r--- 952.00m                                    100.00          
[root@lvm grub2]# mkfs.ext4 /dev/vg_var/lv_var
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
60928 inodes, 243712 blocks
12185 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=249561088
8 block groups
32768 blocks per group, 32768 fragments per group
7616 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done

[root@lvm grub2]# mount /dev/vg_var/lv_var /mnt
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cp -aR /var/* /mnt/      # rsync -avHPSAX /var/ /mnt/
[root@lvm grub2]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
└─vg_var-lv_var_rimage_1 253:5    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  /mnt
sde                        8:64   0    1G  0 disk 
[root@lvm grub2]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# cd /vat
bash: cd: /vat: No such file or directory
[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# df -Th
Filesystem                      Type      Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup00-LogVol00 xfs       8.0G  742M  7.3G  10% /
devtmpfs                        devtmpfs  109M     0  109M   0% /dev
tmpfs                           tmpfs     118M     0  118M   0% /dev/shm
tmpfs                           tmpfs     118M  4.6M  114M   4% /run
tmpfs                           tmpfs     118M     0  118M   0% /sys/fs/cgroup
/dev/sda2                       xfs      1014M   76M  939M   8% /boot
tmpfs                           tmpfs      24M     0   24M   0% /run/user/1000
/dev/mapper/vg_var-lv_var       ext4      922M  116M  742M  14% /mnt
[root@lvm var]# cd /tmp
[root@lvm tmp]# ls
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# mkdir oldvar
[root@lvm tmp]# ls
oldvar
systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-Bq8XU4
systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-4kNhv4
systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-67rTVe
systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-3nos1F
vagrant-shell
[root@lvm tmp]# cd /var
[root@lvm var]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm var]# mv /var/* /tmp/oldvar
mv: cannot move ‘/var/tmp’ to ‘/tmp/oldvar/tmp’: Device or resource busy
[root@lvm var]# cp /var/* /tmp/oldvar
cp: omitting directory ‘/var/tmp’
[root@lvm var]# cp -r /var/* /tmp/oldvar
[root@lvm var]# cd /tmp/oldvar/
[root@lvm oldvar]# ls
adm    db     games   kerberos  local  log   nis  preserve  spool  yp
cache  empty  gopher  lib       lock   mail  opt  run       tmp
[root@lvm oldvar]# ls -lah
total 16K
drwxr-xr-x. 18 root root  238 Dec  5 13:44 .
drwxrwxrwt. 12 root root 4.0K Dec  5 13:45 ..
drwxr-xr-x.  2 root root    6 Apr 11  2018 adm
drwxr-xr-x.  5 root root   44 May 12  2018 cache
drwxr-xr-x.  3 root root   34 May 12  2018 db
drwxr-xr-x.  3 root root   18 May 12  2018 empty
drwxr-xr-x.  2 root root    6 Apr 11  2018 games
drwxr-xr-x.  2 root root    6 Apr 11  2018 gopher
drwxr-xr-x.  3 root root   18 May 12  2018 kerberos
drwxr-xr-x. 28 root root 4.0K Dec  3 22:21 lib
drwxr-xr-x.  2 root root    6 Apr 11  2018 local
lrwxrwxrwx.  1 root root   11 Dec  3 22:21 lock -> ../run/lock
drwxr-xr-x.  8 root root 4.0K Dec  5 13:27 log
lrwxrwxrwx.  1 root root   10 Dec  3 22:21 mail -> spool/mail
drwxr-xr-x.  2 root root    6 Apr 11  2018 nis
drwxr-xr-x.  2 root root    6 Apr 11  2018 opt
drwxr-xr-x.  2 root root    6 Apr 11  2018 preserve
lrwxrwxrwx.  1 root root    6 Dec  3 22:21 run -> ../run
drwxr-xr-x.  8 root root   87 May 12  2018 spool
drwxr-xr-t.  6 root root 4.0K Dec  5 13:44 tmp
drwxr-xr-x.  2 root root    6 Apr 11  2018 yp
[root@lvm oldvar]# rm -r /var/*
rm: descend into directory ‘/var/tmp’? y
rm: descend into directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-00153d4b1627436580100b0f275dab60-chronyd.service-haTWt1’? y
rm: descend into directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-48e7716291cc45f3bc54e3e59817da15-chronyd.service-rArXY6’? y
rm: descend into directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-2edeb7601f8d4ac8a27bb3af8fbbc52e-chronyd.service-pXzYC0’? y
rm: descend into directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty/tmp’? y
rm: remove directory ‘/var/tmp/systemd-private-ba46f2df44484dab930e7a5618f9c84b-chronyd.service-kss6Ty’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# ls /var
tmp
[root@lvm oldvar]# rm -r /var
rm: descend into directory ‘/var’? y
rm: remove directory ‘/var/tmp’? y
rm: cannot remove ‘/var/tmp’: Device or resource busy
[root@lvm oldvar]# umount /mnt
[root@lvm oldvar]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:7    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:2    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0  952M  0 lvm  
└─vg_var-lv_var_rimage_0 253:3    0  952M  0 lvm  
  └─vg_var-lv_var        253:6    0  952M  0 lvm  
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:4    0    4M  0 lvm  
│ └─vg_var-lv_var        253:6    0[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ vi typescript 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ 
[vagrant@lvm ~]$ sudo su 
[root@lvm vagrant]# script
Script started, file is typescript
[root@lvm vagrant]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
└─vg_root-lv_root        253:2    0   10G  0 lvm  
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:3    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:4    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:5    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:6    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 
[root@lvm vagrant]# lvremove /dev/vg_root/lv_root 
Do you really want to remove active logical volume vg_root/lv_root? [y/n]: y
  Logical volume "lv_root" successfully removed
[root@lvm vagrant]# vgremove /dev/vgroot
  Volume group "vgroot" not found
  Cannot process volume group vgroot
[root@lvm vagrant]# vgremove /dev/vg_root
  Volume group "vg_root" successfully removed
[root@lvm vagrant]# vps
bash: vps: command not found
[root@lvm vagrant]# pvs
  PV         VG         Fmt  Attr PSize    PFree  
  /dev/sda3  VolGroup00 lvm2 a--   <38.97g <29.47g
  /dev/sdb              lvm2 ---    10.00g  10.00g
  /dev/sdc   vg_var     lvm2 a--    <2.00g   1.06g
  /dev/sdd   vg_var     lvm2 a--  1020.00m  64.00m
[root@lvm vagrant]# pvremove /dev/sdb
  Labels on physical volume "/dev/sdb" successfully wiped.
[root@lvm vagrant]# lsblk
NAME                     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                        8:0    0   40G  0 disk 
├─sda1                     8:1    0    1M  0 part 
├─sda2                     8:2    0    1G  0 part /boot
└─sda3                     8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00  253:0    0    8G  0 lvm  /
  └─VolGroup00-LogVol01  253:1    0  1.5G  0 lvm  [SWAP]
sdb                        8:16   0   10G  0 disk 
sdc                        8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0  253:3    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0 253:4    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sdd                        8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1  253:5    0    4M  0 lvm  
│ └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1 253:6    0  952M  0 lvm  
  └─vg_var-lv_var        253:7    0  952M  0 lvm  /var
sde                        8:64   0    1G  0 disk 


# Tom for /Home
[root@lvm vagrant]# lvcreate -n LogVol_Home -L 2G /dev/VolGroup00 
  Logical volume "LogVol_Home" created.
[root@lvm vagrant]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm vagrant]# mkfs.xfs /dev/VolGroup00/LogVol_Home 
meta-data=/dev/VolGroup00/LogVol_Home isize=512    agcount=4, agsize=131072 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=524288, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@lvm vagrant]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm vagrant]# mount /dev/VolGroup00/LogVol_Home /mnt/
[root@lvm vagrant]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /mnt
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm vagrant]# cp -aR /home/* /mnt/
[root@lvm vagrant]# ls
typescript
[root@lvm vagrant]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /mnt
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm vagrant]# cd /mnt
[root@lvm mnt]# ls
vagrant
[root@lvm mnt]# cd
[root@lvm ~]# cd /home/
[root@lvm home]# ls
vagrant
[root@lvm home]# cd
[root@lvm ~]# rm -rf /home/*
[root@lvm ~]# umount /mnt
[root@lvm ~]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm ~]# mount /dev/VolGroup00/LogVol_Home /home/
[root@lvm ~]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /home
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm ~]# cd /home/
[root@lvm home]# ls
vagrant
[root@lvm home]# cd
[root@lvm ~]# echo "`blkid | grep Home | awk '{print $2}'` /home xfs defaults 0 0" >> /etc/fstab
[root@lvm ~]# touch /home/file{1..20}
[root@lvm ~]# cd /home/
[root@lvm home]# ls
file1   file11  file13  file15  file17  file19  file20  file4  file6  file8  vagrant
file10  file12  file14  file16  file18  file2   file3   file5  file7  file9
[root@lvm home]# cd
[root@lvm ~]# lvcreate -L 100MB -s -n home_snap /dev/VolGroup00/LogVol_Home
  Rounding up size to full physical extent 128.00 MiB
  Logical volume "home_snap" created.
[root@lvm ~]# lvs
  LV          VG         Attr       LSize   Pool Origin      Data%  Meta%  Move Log Cpy%Sync Convert
  LogVol00    VolGroup00 -wi-ao----   8.00g                                                         
  LogVol01    VolGroup00 -wi-ao----   1.50g                                                         
  LogVol_Home VolGroup00 owi-aos---   2.00g                                                         
  home_snap   VolGroup00 swi-a-s--- 128.00m      LogVol_Home 0.00                                   
  lv_var      vg_var     rwi-aor--- 952.00m                                         100.00          
[root@lvm ~]# lsblk
NAME                            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                               8:0    0   40G  0 disk 
├─sda1                            8:1    0    1M  0 part 
├─sda2                            8:2    0    1G  0 part /boot
└─sda3                            8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00         253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01         253:1    0  1.5G  0 lvm  [SWAP]
  ├─VolGroup00-LogVol_Home-real 253:8    0    2G  0 lvm  
  │ ├─VolGroup00-LogVol_Home    253:2    0    2G  0 lvm  /home
  │ └─VolGroup00-home_snap      253:10   0    2G  0 lvm  
  └─VolGroup00-home_snap-cow    253:9    0  128M  0 lvm  
    └─VolGroup00-home_snap      253:10   0    2G  0 lvm  
sdb                               8:16   0   10G  0 disk 
sdc                               8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0         253:3    0    4M  0 lvm  
│ └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0        253:4    0  952M  0 lvm  
  └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
sdd                               8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1         253:5    0    4M  0 lvm  
│ └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1        253:6    0  952M  0 lvm  
  └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
sde                               8:64   0    1G  0 disk 
[root@lvm ~]# rm -f /home/file{11..20}
[root@lvm ~]# umount /home
[root@lvm ~]# lsblk
NAME                            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                               8:0    0   40G  0 disk 
├─sda1                            8:1    0    1M  0 part 
├─sda2                            8:2    0    1G  0 part /boot
└─sda3                            8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00         253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01         253:1    0  1.5G  0 lvm  [SWAP]
  ├─VolGroup00-LogVol_Home-real 253:8    0    2G  0 lvm  
  │ ├─VolGroup00-LogVol_Home    253:2    0    2G  0 lvm  
  │ └─VolGroup00-home_snap      253:10   0    2G  0 lvm  
  └─VolGroup00-home_snap-cow    253:9    0  128M  0 lvm  
    └─VolGroup00-home_snap      253:10   0    2G  0 lvm  
sdb                               8:16   0   10G  0 disk 
sdc                               8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0         253:3    0    4M  0 lvm  
│ └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0        253:4    0  952M  0 lvm  
  └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
sdd                               8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1         253:5    0    4M  0 lvm  
│ └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1        253:6    0  952M  0 lvm  
  └─vg_var-lv_var               253:7    0  952M  0 lvm  /var
sde                               8:64   0    1G  0 disk 
[root@lvm ~]# cd /home/
[root@lvm home]# ls
[root@lvm home]# cd
[root@lvm ~]# lvconvert --merge /dev/VolGroup00/home_snap 
  Merging of volume VolGroup00/home_snap started.
  VolGroup00/LogVol_Home: Merged: 100.00%
[root@lvm ~]# mount /home/
[root@lvm ~]# lsblk
NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                          8:0    0   40G  0 disk 
├─sda1                       8:1    0    1M  0 part 
├─sda2                       8:2    0    1G  0 part /boot
└─sda3                       8:3    0   39G  0 part 
  ├─VolGroup00-LogVol00    253:0    0    8G  0 lvm  /
  ├─VolGroup00-LogVol01    253:1    0  1.5G  0 lvm  [SWAP]
  └─VolGroup00-LogVol_Home 253:2    0    2G  0 lvm  /home
sdb                          8:16   0   10G  0 disk 
sdc                          8:32   0    2G  0 disk 
├─vg_var-lv_var_rmeta_0    253:3    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_0   253:4    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sdd                          8:48   0    1G  0 disk 
├─vg_var-lv_var_rmeta_1    253:5    0    4M  0 lvm  
│ └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
└─vg_var-lv_var_rimage_1   253:6    0  952M  0 lvm  
  └─vg_var-lv_var          253:7    0  952M  0 lvm  /var
sde                          8:64   0    1G  0 disk 
[root@lvm ~]# cd /home/
[root@lvm home]# ls
file1   file11  file13  file15  file17  file19  file20  file4  file6  file8  vagrant
file10  file12  file14  file16  file18  file2   file3   file5  file7  file9
[root@lvm home]# cd
[root@lvm ~]# exit
exit
Script done, file is typescript

